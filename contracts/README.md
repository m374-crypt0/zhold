# contracts - The on-chain commitment storage layer

> **contracts** is a collection of solidity smart contracts to store
> commitments, revoke them and verify ZKP submitted by a **customer** to ensure
> they are eligible regarding a specific **policy** maintained by an **issuer**

<!--toc:start-->
- [contracts - The on-chain commitment storage layer](#contracts-the-on-chain-commitment-storage-layer)
  - [Responsibilities of contracts](#responsibilities-of-contracts)
    - [Commitment store contract](#commitment-store-contract)
    - [Compliancy prover](#compliancy-prover)
    - [Verifier](#verifier)
  - [Trust boundaries](#trust-boundaries)
  - [Interactions in the entire *zhold* system](#interactions-in-the-entire-zhold-system)
    - [Flows](#flows)
  - [Final words](#final-words)
    - [scaling](#scaling)
<!--toc:end-->

## Responsibilities of contracts

### Commitment store contract

1. Expose functions to commit or revoke commitments
2. Ensure those functions are accessible only by the **issuer**
3. Emit events for each state change

### Compliancy prover

1. Expose a function to prove a caller is eligible regarding a policy without
   disclosure of private data

### Verifier

1. Expose a verification function taking a **ZKP** and a set of public inputs
   returning a boolean regardng the **ZKP** is verified or not.

## Trust boundaries

- A trustful **issuer** specified for the commitment store contract deployment
- The compliancy prover contract should not be upgraded without governance
- The verifier contract is dependant of underlying circuit correctness

## Interactions in the entire *zhold* system

### Flows

```text
+------------------------------------------------------------------------------+
|  Issuer     CommitmentStore    Verifier     CompliancyProver     Customer    |
|    |               |              |                 |                |       |
|    |        (1) Accept a          |                 |                |       |
|    |<-------trusted issuer        |         (7) Accept a             |       |
|    |        when deployed         |<--------trusted Verifier         |       |
|    |               |              |         contract when            |       |
|    |               |              |         deployed                 |       |
|    |               |              |                 |                |       |
|    |               |              |         (8) Accept a             |       |
| (2)|               |<-----------------------commitment store         |       |
| commit   --------->|              |         contract address         |       |
|    |               |              |                 |                |       |
|    |               |              |                 |          (4) prove     |
| (3)|               |              |                 |<-------- eligibility   |
| revoke   --------->|              |                 |                |       |
|    |               |              |                 |                |       |
|    |        (6) Emit state        |                 |                |       |
|    |        change events  ----------------------------------------->|       |
|    |               |              |                 |                |       |
|    |               |              |         (5) verify a ZKP         |       |
|    |               |              |         parameterized            |       |
|    |               |              |<--------with public              |       |
|    |               |              |         inputs  |                |       |
|    |               |              |                 |                |       |
+------------------------------------------------------------------------------+
```

## Final words

The **contracts** set contains both developed contracts (*commitment store*,
*compliancy prover*) and contracts generated by **ZKP** tooling (*Verifier*).

### scaling

If needed, this system could scale by creating a pair of *CompliancyProver* and
*Verifier* for each existing **policy**.
